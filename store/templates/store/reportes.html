{% extends 'store/base.html' %}

{% block content %}
<div class="container animate__animated animate__fadeIn">
    <h2 class="fw-bold mb-4"><i class="bi bi-graph-up-arrow text-success"></i> Dashboard Financiero</h2>

    <div class="row g-4 mb-5">
        <div class="col-md-4">
            <div class="card border-0 shadow-sm bg-primary text-white h-100 rounded-4">
                <div class="card-body p-4">
                    <h5 class="card-title text-white-50">Ventas Totales</h5>
                    <p class="display-5 fw-bold mb-0">${{ total_vendido|default:"0.00" }}</p>
                    <small><i class="bi bi-cash-coin"></i> Ingresos brutos históricos</small>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border-0 shadow-sm bg-white h-100 rounded-4 border-start border-warning border-5">
                <div class="card-body p-4">
                    <h5 class="card-title text-muted">Ordenes Generadas</h5>
                    <p class="display-5 fw-bold mb-0 text-dark">{{ ordenes.count }}</p>
                    <small class="text-warning"><i class="bi bi-cart-check"></i> Transacciones completadas</small>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border-0 shadow-sm bg-white h-100 rounded-4 border-start border-danger border-5">
                <div class="card-body p-4">
                    <h5 class="card-title text-muted">Solicitudes Devolución</h5>
                    <p class="display-5 fw-bold mb-0 text-dark">{{ devoluciones.count }}</p>
                    <small class="text-danger"><i class="bi bi-arrow-return-left"></i> Requieren atención</small>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-6 mb-4">
            <div class="card border-0 shadow rounded-4">
                <div class="card-header bg-white py-3">
                    <h5 class="mb-0 fw-bold">Últimas Ventas</h5>
                </div>
                <div class="card-body p-0">
                    <table class="table table-striped mb-0 small">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Cliente</th>
                                <th>Fecha</th>
                                <th class="text-end">Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for orden in ordenes|slice:":10" %}
                            <tr>
                                <td>#{{ orden.id }}</td>
                                <td>{{ orden.usuario.username }}</td>
                                <td>{{ orden.fecha|date:"d/m/Y" }}</td>
                                <td class="text-end fw-bold text-success">${{ orden.total }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="col-lg-6 mb-4">
            <div class="card border-0 shadow rounded-4">
                <div class="card-header bg-white py-3">
                    <h5 class="mb-0 fw-bold text-danger">Devoluciones Recientes</h5>
                </div>
                <div class="card-body p-0">
                    <table class="table mb-0 small">
                        <thead>
                            <tr>
                                <th>Producto</th>
                                <th>Motivo</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for dev in devoluciones|slice:":10" %}
                            <tr>
                                <td>{{ dev.detalle.producto.nombre }}</td>
                                <td>{{ dev.motivo|truncatechars:30 }}</td>
                                <td>
                                    {% if dev.aprobada %}
                                        <span class="badge bg-success">Aprobada</span>
                                    {% else %}
                                        <span class="badge bg-warning text-dark">Pendiente</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% empty %}
                            <tr><td colspan="3" class="text-center py-3">Sin devoluciones registradas</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}